#!/bin/sh -e
#
# Run the pass container
#
# Usage: run VAULT-DIR
#

CONTAINER="ghcr.io/perfsonar/docker-pass:latest"


die()
{
    echo "$@" 1>&2
    exit 1
}


[ $# -eq 1 ] \
    || die "Usage: $(basename $0) VAULT_DIR"

[ -d "$1" ] \
    || die "$1: Not a directory."

run_container()
{

    exec docker run -it --rm \
	   --name "pass-$(date +%s)" \
	   --hostname "pass" \
	   --pull always \
	   --volume "${HOME}:/vol/home" \
	   "$@" \
	   "${CONTAINER}" \
	   "$(getent passwd $(id -nu))"
}

[ -z "$1" ] \
    && run_container \
    || run_container --volume "$1:/vault"
