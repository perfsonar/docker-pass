#!/bin/sh -e
#
# Run the pass container
#
# Usage: run [ VAULT-DIR ]
#

CONTAINER="ghcr.io/perfsonar/docker-pass:latest"

die()
{
    echo "$@" 1>&2
    exit 1
}

[ $# -le 1 ] \
    || die "Usage: $(basename $0) [ VAULT_DIR ]"


[ -n "$1" ] && VAULT="$1" || VAULT="${HOME}"
[ -d "${VAULT}" ] \
    || die "${VAULT}: Not a directory."

docker run -it --rm \
       --pull always \
       --volume "${HOME}:/vol/home" \
       --volume "${VAULT}:/vol/vault" \
       "${CONTAINER}" \
       "$(getent passwd $(id -nu))"
